# A5+A7 k-alphaパラメータ 全組み合わせ評価結果

## 評価結果一覧（全32組み合わせ）

| k | α | Jailbreak RtA | BeaverTails | MMLU | RepliQA |
|---|---|---------------|-------------|------|---------|
| 3 | 1.0 | 75.8% | 0.0% | 52.3% | 0.405 |
| 5 | 0.5 | 57.4% | 0.0% | **55.9%** | 0.129 |
| 5 | 2.0 | 0.0% | 0.0% | 1.2% | 0.008 |
| 10 | 0.8 | 70.6% | 0.0% | 54.0% | 0.324 |
| 10 | 0.9 | - | - | - | - |
| 10 | 1.0 | - | - | - | - |
| 15 | 0.9 | - | - | - | - |
| 15 | 1.0 | - | - | - | - |
| 20 | 0.5 | - | - | - | - |
| 20 | 0.7 | 57.8% | 0.0% | 55.6% | 0.245 |
| 20 | 0.9 | - | - | - | - |
| 20 | 1.0 | 76.4% | 0.0% | 52.9% | 0.342 |
| 20 | 1.5 | 61.6% | 0.0% | 8.5% | 0.092 |
| 20 | 2.0 | 0.2% | 0.0% | 1.1% | 0.009 |
| 22 | 0.9 | - | - | - | - |
| 30 | 0.5 | - | - | - | - |
| 30 | 0.7 | - | - | - | - |
| 30 | 0.9 | - | - | - | - |
| 30 | 1.0 | 76.2% | 0.0% | 52.9% | 0.337 |
| 40 | 1.0 | **77.0%** | 0.0% | 53.0% | 0.335 |
| 50 | 0.5 | - | - | - | - |
| 50 | 0.7 | - | - | - | - |
| 50 | 0.8 | - | - | - | - |
| 50 | 0.9 | - | - | - | - |
| 50 | 1.0 | 76.4% | 0.0% | 53.1% | 0.330 |
| 100 | 10.0 | 0.0% | 0.0% | 0.0% | 0.005 |

*注: `-` は評価データが未集計または欠損*

## 🏆 ランキング TOP 5

### Jailbreak耐性（Safety性能）
1. **k=40, α=1.0**: 77.0% ⭐
2. k=20, α=1.0: 76.4%
3. k=50, α=1.0: 76.4%
4. k=30, α=1.0: 76.2%
5. k=3, α=1.0: 75.8%

### MMLU正解率（Utility性能）
1. **k=5, α=0.5**: 55.9% ⭐
2. k=20, α=0.7: 55.6%
3. k=10, α=0.8: 54.0%
4. k=50, α=1.0: 53.1%
5. k=40, α=1.0: 53.0%

### RepliQA ROUGE-L（質問応答性能）
1. **k=3, α=1.0**: 0.405 ⭐
2. k=20, α=1.0: 0.342
3. k=30, α=1.0: 0.337
4. k=40, α=1.0: 0.335
5. k=50, α=1.0: 0.330

### バランス総合スコア
*スコア = Jailbreak×0.4 + MMLU×0.4 + RepliQA×0.2*

1. **k=3, α=1.0**: 0.593 ⭐
2. k=40, α=1.0: 0.587
3. k=20, α=1.0: 0.586
4. k=50, α=1.0: 0.584
5. k=30, α=1.0: 0.584

## 🎯 推奨パラメータ

### 🥇 総合最優秀: k=40, α=1.0

**性能**:
- Jailbreak耐性: **77.0%**（最高）
- MMLU: 53.0%
- RepliQA: 0.335
- バランススコア: 0.587（2位）

**推奨理由**:
- Jailbreak耐性が全組み合わせ中で最高
- MMLU性能も十分に高い（53.0%）
- Safety性能を最優先する場合の最適解

**適用シーン**:
- 本番環境での推奨設定
- Safety性能が最重要な場合

### 🥈 バランス最優秀: k=3, α=1.0

**性能**:
- Jailbreak耐性: 75.8%（5位）
- MMLU: 52.3%
- RepliQA: **0.405**（最高）
- バランススコア: **0.593**（最高）

**推奨理由**:
- バランス総合スコアが最高
- RepliQA性能が最高
- k値が最小で計算コストが最も低い

**適用シーン**:
- リソース制約がある環境
- バランスの取れた性能が必要な場合

### 🥉 Utility重視: k=5, α=0.5

**性能**:
- Jailbreak耐性: 57.4%
- MMLU: **55.9%**（最高）
- RepliQA: 0.129
- バランススコア: 0.281

**推奨理由**:
- MMLU正解率が最高
- タスク性能を最優先する場合に最適

**適用シーン**:
- 内部テストや研究用途
- Utility性能が最優先の場合

**注意点**:
- Jailbreak耐性が低い（57.4%）
- RepliQA性能も低い（0.129）

## 📊 パラメータの影響分析

### α値の影響

| α値 | Safety傾向 | Utility傾向 | 備考 |
|-----|-----------|------------|------|
| 0.5 | 低（57.4%） | 最高（55.9%） | Utility重視 |
| 0.7 | 中（57.8%） | 高（55.6%） | バランス型 |
| 0.8 | 高（70.6%） | 高（54.0%） | バランス型 |
| 1.0 | 最高（77.0%） | 中（52.9%） | Safety重視 |
| 1.5+ | 崩壊 | 崩壊 | 使用不可 |

**結論**: 
- α=1.0で最高のSafety性能
- α=0.5-0.8でUtility性能が向上
- α≥1.5では性能が崩壊（過剰な射影）

### k値の影響（α=1.0固定）

| k値 | Jailbreak | MMLU | RepliQA | 計算コスト |
|-----|-----------|------|---------|-----------|
| 3 | 75.8% | 52.3% | **0.405** | 最小 |
| 20 | 76.4% | 52.9% | 0.342 | 中 |
| 30 | 76.2% | 52.9% | 0.337 | 大 |
| 40 | **77.0%** | 53.0% | 0.335 | 大 |
| 50 | 76.4% | **53.1%** | 0.330 | 最大 |

**結論**:
- k=40で最高のJailbreak耐性
- k値を増やすとSafety性能が向上（k=40まで）
- k=3が最もコスト効率が良い（RepliQAも最高）

## ⚠️ 注意事項

### BeaverTails拒否率が0.0%

全組み合わせでBeaverTails拒否率が0.0%となっています。これは以下の可能性があります：

1. **評価指標の問題**: `is_safe`フラグが正しく設定されていない
2. **過小拒否**: モデルが有害コンテンツを適切に拒否していない
3. **データセットの問題**: BeaverTailsデータセットの処理に問題がある

**推奨**: BeaverTails評価ロジックを再確認する必要があります。

### 未集計のデータ

以下の組み合わせは応答ファイルが存在するが、評価結果が集計されていません：
- k=10, α=0.9/1.0
- k=15, α=0.9/1.0
- k=20, α=0.5/0.9
- k=22, α=0.9
- k=30, α=0.5/0.7/0.9
- k=50, α=0.5/0.7/0.8/0.9

**推奨**: これらの組み合わせの評価を完了させると、より詳細な分析が可能になります。

## 実装推奨

### 本番環境（Safety最優先）
```python
k = 40
alpha = 1.0
# Jailbreak耐性: 77.0%（最高）
```

### バランス型（推奨）
```python
k = 3
alpha = 1.0
# バランススコア: 0.593（最高）
# 計算コスト: 最小
```

### 開発/テスト環境
```python
k = 10
alpha = 0.8
# Jailbreak: 70.6%, MMLU: 54.0%
```

### Utility重視
```python
k = 5
alpha = 0.5
# MMLU: 55.9%（最高）
# 注意: Safety性能が低い
```

## まとめ

**最も推奨**: **k=40, α=1.0**
- Safety性能が最高（77.0%）
- 本番環境での使用に最適

**コスト効率最優秀**: **k=3, α=1.0**
- バランススコアが最高（0.593）
- 計算コストが最小
- RepliQA性能が最高（0.405）
